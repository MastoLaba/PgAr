package deathstar.consegna4;

import java.util.Comparator;

/**
 * Classe che implementa l'idea di un periodo di tempo all'interno di una giornata.
 * 
 * @author Michele Dusi
 */
public class Intervallo {

	private static final int HCOEFF = 100;
	private static final int MINUTES_PER_HOUR = 60;
	private static final int DIFF = HCOEFF - MINUTES_PER_HOUR;
	public static final int DAY_LIMIT = 2400; // Forse ha senso mantenere l'attributo public in caso di or"%n %02d:%02d - %02d:%02d;ari a cavallo della mezzanotte, in realtà boh, devo pensarci (TODO)
	public static final String STRING_FORMAT = "%02d:%02d-%02d:%02d";
	
	private int ora_inizio;
	private int ora_fine;
	// Sono numeri di 4 cifre del tipo HHMM, con notazione a 24 ore.
	
	public static final Comparator<Intervallo> COMPARATOR = (int1, int2) -> {
		if (int1.getFine() < int2.getInizio()) return -1;
		else if (int1.getInizio() > int2.getFine()) return 1;
		else return 0;
	};
	
	public Intervallo(int _start, int _end) {
		this.ora_inizio = _start;
		this.ora_fine = _end;
	}

	// TODO valutare l'effettiva utilità dei tre getters
	
	public int getInizio() {
		return this.ora_inizio;
	}

	public int getFine() {
		return this.ora_fine;
	}
	
	public int getDurata() {
		int delta = ora_fine - ora_inizio;
		if (delta % HCOEFF > MINUTES_PER_HOUR) {
			delta -= DIFF;
		}
		return delta;
	}
	
	public boolean controllaSovrapposizione(Intervallo altro_intervallo) {
		return (this.ora_fine > altro_intervallo.ora_inizio) && (altro_intervallo.ora_fine > this.ora_inizio);
	}

	public void unisci(Intervallo nuovo_intervallo) {
		this.ora_inizio = Math.min(this.ora_inizio, nuovo_intervallo.ora_inizio);
		this.ora_fine = Math.max(this.ora_fine, nuovo_intervallo.ora_fine);
	}
	
	// NOTA: questo metodo viene chiamato SOLO SE i due intervalli si sovrappongono
	public Intervallo sottrai(Intervallo intervallo_da_rimuovere) throws IllegalStateException {
		Intervallo secondo_intervallo = new Intervallo(intervallo_da_rimuovere.ora_fine, this.ora_fine);
		this.ora_fine = intervallo_da_rimuovere.ora_inizio;
		return secondo_intervallo;
	}
	
	public boolean isInvalido() {
		return (this.ora_inizio >= this.ora_fine);
	}
	
	public String toString() {
		int min_inizio = this.ora_inizio % HCOEFF;
		int min_fine = this.ora_fine % HCOEFF;
		int h_inizio = this.ora_inizio / HCOEFF;
		int h_fine = this.ora_fine / HCOEFF;
		return String.format(STRING_FORMAT, h_inizio, min_inizio, h_fine, min_fine);
	}

}
